# Witcher Dialogue Bot

**!Внимание!** Учебный некоммерческий проект.

Интерактивный чат-бот для общения с персонажами «Ведьмака».  
Бот умеет вести диалог в стиле выбранного персонажа, используя сцены из книг и расширенный поиск по контексту.

## Возможности
- Общение с любым персонажем из книг Сапковского.
- Смена персонажа в любой момент командой /switch.
- Поиск релевантных сцен книги (BM25 + FAISS + NER).
- Простая интеграция через FastAPI и Telegram.

## Структура проекта

Вес чистых образов и контейнера: ~5.5 Гб.
Время установки: ~10 мин.

```text
witcher-bot/
│
├── api/                  # FastAPI сервер (поиск и генерация ответов)
│   ├── chat.py
│   ├── indexer.py
│   ├── main.py
│   └── search.py
│
├── bot/                  # Telegram-бот (aiogram)
│   └── bot.py
│
├── data/                 # Данные
│   ├── characters.json
│   ├── prepare_data.py
│   └── scenes.json
│
├── parser/               # Парсер книг в формат scenes.jsonl
│   └── parser.py
│
├── .dockerignore         # Список файлов и папок, которые не будут добавлены в Docker образ 
├── Dockerfile            # Образ для API
├── Dockerfile.bot        # Образ для бота
├── docker-compose.yml    # Запуск всей системы
├── requirements.txt      # Python зависимости
└── README.md             
```

## Установка и запуск

### 1. Склонировать проект

```Bash
git clone https://github.com/YauheniMa/witcher-bot.git
cd witcher-bot
```

### 2. Подготовить данные
- Положите файл scenes.jsonl в папку data/.  
  Его можно сгенерировать с помощью парсера (`parser/parse_book.py`).

### 3. Запустить контейнеры

```Bash
docker compose up --build
```

Будут подняты два сервиса:
- API (FastAPI на порту `8000`)
- Telegram Bot

### 4. Настройка переменных окружения
В файле .env укажите:

```shell
API_TOKEN=<ваш_тг_токен>
FASTAPI_URL=http://api:8000/ask
```

### 5. Использование
1. Напишите /start боту или нажмите кнопку "Старт".
2. Укажите персонажа, с кем хотите общаться.
3. Задавайте вопросы и получайте ответы в стиле выбранного персонажа.
4. Для смены персонажа используйте /switch или кнопку в выпадающем меню.

## Добавление новых книг
Для генерации нового scenes.jsonl:

```Bash
python parser/parse_book.py <путь_к_книге.txt>
```

Полученный файл сохраните в data/.

## Технологии
- Python 3.10
- FastAPI
- aiogram 3.x
- FAISS, BM25
- Natasha (NER для русского текста)



## **Авторские права и лицензии**

**Исходный код**

Исходный код этого учебного проекта распространяется под лицензией MIT License.

**Используемые материалы и сторонние компоненты**

  - **Тексты книг серии «Ведьмак»**: Авторские права принадлежат Анджею Сапковскому и правообладателям. Используются исключительно в учебных целях для исследования технологий NLP. Данный проект не содержит тексты книг и не распространяет их.
  - **gpt4free**: Проект использует [gpt4free](https://github.com/xtekky/gpt4free) (лицензия AGPL-3.0) в качестве инструмента для генерации текста в учебных целях.
  - Персонажи и вселенная «Ведьмака» являются интеллектуальной собственностью Анджея Сапковского. CD PROJEKT RED является правообладателем игровой серии, но не книжного исходного материала.

**Важное примечание**

Этот проект создан строго в образовательных целях для изучения программирования, обработки естественного языка и работы с API. Он не является официальным продуктом, не одобрен и не связан с Анджеем Сапковским, его издателями или CD PROJEKT RED.
